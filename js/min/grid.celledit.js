!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],t):"object"==typeof module&&module.exports?module.exports=function(e,l){return e=e||window,void 0===l&&(l="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),t(l),l}:t(jQuery)}(function(k){"use strict";function E(){var e=k.makeArray(arguments);return e.unshift(""),e.unshift(""),e.unshift(this.p),R.feedback.apply(this,e)}function I(e,l){var t=this.grid.fbRows;return null!=(e=null!=t&&t[0].cells.length>l?t[e.rowIndex]:e)&&null!=e.cells?k(e.cells[l]):k()}var R=k.jgrid;R.extend({editCell:function(b,w,j){return this.each(function(){var e,l,t,i=this,r=k(i),a=i.p,n=i.rows;if(i.grid&&!0===a.cellEdit&&null!=n&&null!=n[b]&&(b=parseInt(b,10),w=parseInt(w,10),!isNaN(b)&&!isNaN(w))){var o=n[b],d=null!=o?o.id:null,s=k(o),c=parseInt(a.iCol,10),u=parseInt(a.iRow,10),n=k(n[u]),f=a.savedRow;if(null!=d){if(a.selrow=d,a.knv||r.jqGrid("GridNav"),0<f.length&&0<n.length){if(!0===j&&b===u&&w===c)return;r.jqGrid("saveCell",f[0].id,f[0].ic)}else setTimeout(function(){k("#"+R.jqID(a.knv)).attr("tabindex","-1").focus()},1);if("subgrid"!==(e=(t=a.colModel[w]).name)&&"cb"!==e&&"rn"!==e){var h=I.call(i,o,w),p=t.editable,m="cell",C=(k.isFunction(p)&&(p=p.call(i,{rowid:d,iCol:w,iRow:b,cmName:e,cm:t,mode:m})),r.jqGrid("getGuiStyles","states.select","edit-cell")),v=r.jqGrid("getGuiStyles","states.hover","selected-row");if(!0!==p||!0!==j||h.hasClass("not-editable-cell"))a.noCellSelection||(0<=c&&0<=u&&(I.call(i,n[0],c).removeClass(C),n.removeClass(v)),h.addClass(C),s.addClass(v)),l=h.html().replace(/&#160;/gi,""),E.call(i,"onSelectCell",d,e,l,b,w);else{a.noCellSelection||(0<=c&&0<=u&&(I.call(i,n[0],c).removeClass(C),n.removeClass(v)),h.addClass(C),s.addClass(v)),t.edittype||(t.edittype="text"),u=t.edittype;try{l=k.unformat.call(i,h,{rowId:d,colModel:t},w)}catch(e){l="textarea"===u?h.text():h.html()}("&nbsp;"===(l=a.autoEncodeOnEdit?R.oldDecodePostedData(l):l)||"&#160;"===l||1===l.length&&160===l.charCodeAt(0))&&(l=""),!k.isFunction(a.formatCell)||void 0!==(c=a.formatCell.call(i,d,e,l,b,w))&&(l=c),E.call(i,"beforeEditCell",d,e,l,b,w),f.push({id:b,ic:w,name:e,v:l}),a.editingInfo[d]={mode:"cellEditing",savedRow:f[f.length-1],editable:{}},a.editingInfo[d].editable[e]=p;var n=k.extend({},t.editoptions||{},{id:b+"_"+e,name:e,rowId:d,mode:m,cm:t,iCol:w}),g=R.createEl.call(i,u,n,l,!0,k.extend({},R.ajaxOptions,a.ajaxSelectOptions||{})),C=h,s=!0===a.treeGrid&&e===a.ExpandColumn;(C=s?h.children("span.cell-wrapperleaf,span.cell-wrapper"):C).html("").append(g).attr("tabindex","0"),s&&k(g).width(h.width()-h.children("div.tree-wrap").outerWidth()),R.bindEv.call(i,g,n),a.frozenColumns&&w<r.jqGrid("getNumberOfFrozenColumns")&&(v=k(i.rows[o.rowIndex].cells[w]),c=h.height(),f=v.height(),1<=Math.abs(f-c)&&0<c&&(v.height(c),f=v.height(),1<=Math.abs(c-f)&&v.height(c+Math.round(c-f)))),setTimeout(function(){k(g).focus()},0),k("input, select, textarea",h).on("keydown",function(e){if(27===e.keyCode&&(!(0<k("input.hasDatepicker",h).length)||k(".ui-datepicker").is(":hidden")?r.jqGrid("restoreCell",b,w):k("input.hasDatepicker",h).datepicker("hide")),13===e.keyCode&&!e.shiftKey)return r.jqGrid("saveCell",b,w),!1;if(9===e.keyCode){if(i.grid.hDiv.loading)return!1;e.shiftKey?r.jqGrid("prevCell",b,w):r.jqGrid("nextCell",b,w)}e.stopPropagation()}),E.call(i,"afterEditCell",d,e,l,b,w)}a.iCol=w,a.iRow=b}}}})},saveCell:function(y,x){return this.each(function(){var i=this,r=k(i),a=i.p,t=i.grid,n=R.info_dialog,e=R.jqID;if(t&&!0===a.cellEdit){var l=r.jqGrid("getGridRes","errors"),o=l.errcap,d=r.jqGrid("getGridRes","edit").bClose,s=a.savedRow,c=1<=s.length?0:null;if(null!==c){var u=i.rows[y],f=null!=u?u.id:null,h=null!=u?k(u):k(),p=a.colModel[x],m=p.name,C=I.call(i,u,x),v={},g=R.getEditedValue.call(i,C,p,v);if(g!==s[c].v){void 0!==(w=r.triggerHandler("jqGridBeforeSaveCell",[f,m,g,y,x]))&&(g=w),k.isFunction(a.beforeSaveCell)&&void 0!==(w=a.beforeSaveCell.call(i,f,m,g,y,x))&&(g=w);var b=R.checkValues.call(i,g,x,void 0,void 0,{oldValue:s[c].v,newValue:g,cmName:m,rowid:f,iCol:x,iRow:y,cm:p,tr:u,td:C,mode:"cell"}),w=p.formatoptions||{};if(null==b||!0===b||!0===b[0]){c=r.triggerHandler("jqGridBeforeSubmitCell",[f,m,g,y,x])||{};if(k.isFunction(a.beforeSubmitCell)&&(c=(c=a.beforeSubmitCell.call(i,f,m,g,y,x))||{}),0<k("input.hasDatepicker",C).length&&k("input.hasDatepicker",C).datepicker("hide"),"date"===p.formatter&&!0!==w.sendFormatted&&(g=k.unformat.date.call(i,g,p)),"remote"===a.cellsubmit)if(a.cellurl){var j={},w=(j[m]=g,a.prmNames),q=w.id,G=w.oper;j[q]=R.stripPref(a.idPrefix,f),j[G]=w.editoper,j=k.extend(c,j),a.autoEncodeOnEdit&&k.each(j,function(e,l){k.isFunction(l)||(j[e]=R.oldEncodePostedData(l))}),r.jqGrid("progressBar",{method:"show",loadtype:a.loadui,htmlcontent:r.jqGrid("getGridRes","defaults.savetext")||"Saving..."}),t.hDiv.loading=!0,k.ajax(k.extend({url:k.isFunction(a.cellurl)?a.cellurl.call(i,a.cellurl,y,x,f,g,m):a.cellurl,data:R.serializeFeedback.call(i,a.serializeCellData,"jqGridSerializeCellData",j),type:"POST",complete:function(e){var l;t.endReq.call(i),!(e.status<300||304===e.status)||0===e.status&&4===e.readyState||(null==(l=!0===(l=r.triggerHandler("jqGridAfterSubmitCell",[i,e,j.id,m,g,y,x])||[!0,""])||!0===l[0]&&k.isFunction(a.afterSubmitCell)?a.afterSubmitCell.call(i,e,j.id,m,g,y,x):l)||!0===l||!0===l[0]?(r.jqGrid("setCell",f,x,g,!1,!1,!0),C.addClass("dirty-cell"),h.addClass("edited"),E.call(i,"afterSaveCell",f,m,g,y,x),s.splice(0,1),delete a.editingInfo[f]):(n.call(i,o,l[1],d),r.jqGrid("restoreCell",y,x)))},error:function(e,l,t){r.triggerHandler("jqGridErrorCell",[e,l,t]),k.isFunction(a.errorCell)?a.errorCell.call(i,e,l,t):n.call(i,o,e.status+" : "+e.statusText+"<br/>"+l,d),r.jqGrid("restoreCell",y,x)}},R.ajaxOptions,a.ajaxCellOptions||{}))}else try{n.call(i,o,l.nourl,d),r.jqGrid("restoreCell",y,x)}catch(e){}if("clientArray"===a.cellsubmit){if(r.jqGrid("setCell",f,x,"select"===p.edittype&&"select"!==p.formatter?v.text:g,!1,!1,!0),C.addClass("dirty-cell"),h.addClass("edited"),E.call(i,"afterSaveCell",f,m,g,y,x),a.frozenColumns&&x<r.jqGrid("getNumberOfFrozenColumns"))try{i.rows[u.rowIndex].cells[x].style.height=""}catch(e){}s.splice(0,1),delete a.editingInfo[f]}}else try{setTimeout(function(){var e=R.getRelativeRect.call(i,C);n.call(i,o,g+" "+b[1],d,{top:e.top,left:e.left+k(i).closest(".ui-jqgrid").offset().left})},50),r.jqGrid("restoreCell",y,x)}catch(e){}}else r.jqGrid("restoreCell",y,x)}setTimeout(function(){k("#"+e(a.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(d,s){return this.each(function(){var e,l,t=this,i=t.p,r=t.rows[d],a=r.id;if(t.grid&&!0===i.cellEdit){var n=i.savedRow,o=I.call(t,r,s);if(1<=n.length){if(k.isFunction(k.fn.datepicker))try{k("input.hasDatepicker",o).datepicker("hide")}catch(e){}if(e=i.colModel[s],(!0===i.treeGrid&&null!=e&&e.name===i.ExpandColumn?o.children("span.cell-wrapperleaf,span.cell-wrapper"):o).empty(),o.attr("tabindex","-1"),o=n[0].v,null!=e&&(l=e.formatoptions||{},"date"===e.formatter&&!0!==l.sendFormatted&&(o=k.unformat.date.call(t,o,e)),k(t).jqGrid("setCell",a,s,o,!1,!1,!0),i.frozenColumns&&s<k(t).jqGrid("getNumberOfFrozenColumns")))try{t.rows[r.rowIndex].cells[s].style.height=""}catch(e){}E.call(t,"afterRestoreCell",a,o,d,s),n.splice(0,1),delete i.editingInfo[a]}setTimeout(function(){k("#"+i.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(d,s){return this.each(function(){var e,l,t,i=this,r=k(i),a=i.p,n=!1,o=i.rows;if(i.grid&&!0===a.cellEdit&&null!=o&&null!=o[d]){for(e=s+1;e<a.colModel.length;e++)if(l=(t=a.colModel[e]).editable,!0===(l=k.isFunction(l)?l.call(i,{rowid:o[d].id,iCol:e,iRow:d,cmName:t.name,cm:t,mode:"cell"}):l)){n=e;break}!1!==n?r.jqGrid("editCell",d,n,!0):0<a.savedRow.length&&r.jqGrid("saveCell",d,s)}})},prevCell:function(d,s){return this.each(function(){var e,l,t,i=this,r=k(i),a=i.p,n=!1,o=i.rows;if(i.grid&&!0===a.cellEdit&&null!=o&&null!=o[d]){for(e=s-1;0<=e;e--)if(l=(t=a.colModel[e]).editable,!0===(l=k.isFunction(l)?l.call(i,{rowid:o[d].id,iCol:e,iRow:d,cmName:t.name,cm:t,mode:"cell"}):l)){n=e;break}!1!==n?r.jqGrid("editCell",d,n,!0):0<a.savedRow.length&&r.jqGrid("saveCell",d,s)}})},GridNav:function(){return this.each(function(){var i,r,o,e,d=this,a=k(d),n=d.p,l=d.grid;function s(e,l,t){var i,r,a,n,e=d.rows[e];"v"===t.substr(0,1)&&(i=o.clientHeight,n=o.scrollTop,r=e.offsetTop+e.clientHeight,a=e.offsetTop,"vd"===t&&n+i<=r&&(o.scrollTop=o.scrollTop+e.clientHeight),"vu"===t&&a<n&&(o.scrollTop=o.scrollTop-e.clientHeight)),"h"===t&&(i=o.clientWidth,r=o.scrollLeft,n=(a=e.cells[l]).offsetLeft+a.clientWidth,t=a.offsetLeft,n>=i+parseInt(r,10)?o.scrollLeft=o.scrollLeft+a.clientWidth:t<r&&(o.scrollLeft=o.scrollLeft-a.clientWidth))}function c(e,l){var t,i=0,r=n.colModel;if("lft"===l)for(i=e+1,t=e;0<=t;t--)if(!0!==r[t].hidden){i=t;break}if("rgt"===l)for(i=e-1,t=e;t<r.length;t++)if(!0!==r[t].hidden){i=t;break}return i}l&&!0===n.cellEdit&&(o=l.bDiv,n.knv=n.id+"_kn",e=k("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+n.knv+"'></div></div>"),k(e).insertBefore(l.cDiv),k("#"+n.knv).focus().keydown(function(e){var l=parseInt(n.iRow,10),t=parseInt(n.iCol,10);switch(r=e.keyCode,"rtl"===n.direction&&(37===r?r=39:39===r&&(r=37)),r){case 38:0<l-1&&(s(l-1,t,"vu"),a.jqGrid("editCell",l-1,t,!1));break;case 40:l+1<=d.rows.length-1&&(s(l+1,t,"vd"),a.jqGrid("editCell",l+1,t,!1));break;case 37:0<=t-1&&(s(l,i=c(t-1,"lft"),"h"),a.jqGrid("editCell",l,i,!1));break;case 39:t+1<=n.colModel.length-1&&(s(l,i=c(t+1,"rgt"),"h"),a.jqGrid("editCell",l,i,!1));break;case 13:0<=t&&0<=l&&a.jqGrid("editCell",l,t,!0);break;default:return!0}return!1}))})},getChangedCells:function(u){var e=[];return u=u||"all",this.each(function(){var o=this,d=o.p,s=R.htmlDecode,c=o.rows;o.grid&&!0===d.cellEdit&&k(c).each(function(r){var a,n={};k(this).hasClass("edited")&&(k((a=this).cells).each(function(e){var l=d.colModel[e],t=l.name,i=I.call(o,a,e);if("cb"!==t&&"subgrid"!==t&&"rn"!==t&&("dirty"!==u||i.hasClass("dirty-cell")))try{n[t]=k.unformat.call(o,i[0],{rowId:c[r].id,colModel:l},e)}catch(e){n[t]=s(i.html())}}),n.id=this.id,e.push(n))})}),e}})});
//# sourceMappingURL=grid.celledit.js.map