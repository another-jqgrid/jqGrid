!function(t,r){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],function(e){return r(e,t)}):"object"==typeof module&&module.exports?module.exports=function(e,t){return e=e||window,void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("./grid.common"),r(t,e),t}:r(jQuery,t)}("undefined"!=typeof window?window:this,function(S,s){"use strict";var C=S.jgrid;S.fn.jqFilter=function(e){if("string"==typeof e){var t,r=S.fn.jqFilter[e];if(r)return t=S.makeArray(arguments).slice(1),r.apply(this,t);throw"jqFilter - No such method: "+e}var R=S.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},C.filter,e||{});return this.each(function(){if(!this.filter){null!==(this.p=R).filter&&void 0!==R.filter||(R.filter={groupOp:R.groupOps[0].op,rules:[],groups:[]});var e,t,r=R.columns.length,D=/msie/i.test(navigator.userAgent)&&!s.opera,F=S.isFunction,n=null!=C.defaults&&F(C.defaults.fatalError)?C.defaults.fatalError:alert,k=function(){return S("#"+C.jqID(R.id))[0]||null},q=function(e,t){return S(k()).jqGrid("getGuiStyles",e,t||"")},A=function(e){return S(k()).jqGrid("getGridRes","search."+e)},j=function(e){var t=k(),r=t.p.iColByName[e];return void 0!==r?{cm:t.p.colModel[r],iCol:r}:void 0!==(r=t.p.iPropByName[e])?{cm:t.p.additionalProperties[r],iCol:r,isAddProp:!0}:{cm:null,iCol:-1}},h=q("states.error"),o=q("dialog.content");if(R.initFilter=S.extend(!0,{},R.filter),r){for(e=0;e<r;e++)(t=R.columns[e]).stype?t.inputtype=t.stype:t.inputtype||(t.inputtype="text"),t.sorttype?t.searchtype=t.sorttype:t.searchtype||(t.searchtype="string"),void 0===t.hidden&&(t.hidden=!1),t.label||(t.label=t.name),t.cmName=t.name,t.index&&(t.name=t.index),t.hasOwnProperty("searchoptions")||(t.searchoptions={}),t.hasOwnProperty("searchrules")||(t.searchrules={});R.showQuery&&S(this).append("<table class='queryresult "+o+"' style='display:block;max-width:440px;border:0px none;' dir='"+R.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var i=function(e,t){var r=[!0,""],n=k();if(F(t.searchrules))r=t.searchrules.call(n,e,t);else if(C&&C.checkValues)try{r=C.checkValues.call(n,e,-1,t.searchrules,t.label)}catch(e){}r&&r.length&&!1===r[0]&&(R.error=!r[0],R.errmsg=r[1])};this.onchange=function(){return R.error=!1,R.errmsg="",!!F(R.onChange)&&R.onChange.call(k(),R,this)},this.reDraw=function(){S("table.group:first",this).remove();var e=this.createTableForGroup(R.filter,null);S(this).append(e),F(R.afterRedraw)&&R.afterRedraw.call(k(),R,this)},this.createTableForGroup=function(n,e){var o=this,t=S("<table class='"+q("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),r="left",s=("rtl"===R.direction&&(r="right",t.attr("dir","rtl")),null===e&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+h+"' align='"+r+"'></th></tr>"),S("<tr></tr>")),r=(t.append(s),S("<th colspan='5' align='"+r+"'></th>"));if(s.append(r),!0===R.ruleButtons){for(var a,i=S("<select class='"+q("searchDialog.operationSelect","opsel")+"'></select>"),p=(r.append(i),""),l=0;l<R.groupOps.length;l++)a=n.groupOp===o.p.groupOps[l].op?" selected='selected'":"",p+="<option value='"+o.p.groupOps[l].op+"'"+a+">"+o.p.groupOps[l].text+"</option>";i.append(p).on("change",function(){n.groupOp=S(i).val(),o.onchange()})}var u,c,d,s="<span></span>";if(R.groupButton&&(s=S("<input type='button' value='+ {}' title='"+A("addGroupTitle")+"' class='"+q("searchDialog.addGroupButton","add-group")+"'/>")).on("click",function(){return void 0===n.groups&&(n.groups=[]),n.groups.push({groupOp:R.groupOps[0].op,rules:[],groups:[]}),o.reDraw(),o.onchange(),!1}),r.append(s),!0===R.ruleButtons&&((s=S("<input type='button' value='+' title='"+A("addRuleTitle")+"' class='"+q("searchDialog.addRuleButton","add-rule ui-add")+"'/>")).on("click",function(){var e,t,r;for(void 0===n.rules&&(n.rules=[]),l=0;l<o.p.columns.length;l++)if(e=void 0===o.p.columns[l].search||o.p.columns[l].search,t=!0===o.p.columns[l].hidden,!0===o.p.columns[l].searchoptions.searchhidden&&e||e&&!t){u=o.p.columns[l];break}return r=u.searchoptions.sopt||o.p.sopt||(-1!==S.inArray(u.searchtype,o.p.strarr)?o.p.stropts:o.p.numopts),n.rules.push({field:u.name,op:r[0],data:""}),o.reDraw(),!1}),r.append(s)),null!==e&&(s=S("<input type='button' value='-' title='"+A("deleteGroupTitle")+"' class='"+q("searchDialog.deleteGroupButton","delete-group")+"'/>"),r.append(s),s.on("click",function(){for(l=0;l<e.groups.length;l++)if(e.groups[l]===n){e.groups.splice(l,1);break}return o.reDraw(),o.onchange(),!1})),void 0!==n.groups)for(l=0;l<n.groups.length;l++)c=S("<tr></tr>"),t.append(c),d=S("<td class='first'></td>"),c.append(d),(d=S("<td colspan='4'></td>")).append(this.createTableForGroup(n.groups[l],n)),c.append(d);if(void 0===n.groupOp&&(n.groupOp=o.p.groupOps[0].op),void 0!==n.rules)for(l=0;l<n.rules.length;l++)t.append(this.createTableRowForRule(n.rules[l],n));return t},this.createTableRowForRule=function(c,e){for(var d,t,r,h,n,o,f=this,g=k(),s=S("<tr></tr>"),a="",i=(s.append("<td class='first'></td>"),S("<td class='columns'></td>")),m=(s.append(i),S("<select class='"+q("searchDialog.label","selectLabel")+"'></select>")),y=[],p=(i.append(m),m.on("change",function(){c.field=S(m).val();for(var e,t=S(this).parents("tr:first"),r=0;r<f.p.columns.length;r++)if(f.p.columns[r].name===c.field){e=f.p.columns[r];break}if(e){var n,o,s,a,i=S.extend({},e.editoptions||{}),i=(delete i.readonly,delete i.disabled,S.extend({},i||{},e.searchoptions||{},j(e.cmName),{id:C.randId(),name:e.name,mode:"search"})),p=(i.column=e,!D||"text"!==e.inputtype||i.size||(i.size=10),C.createEl.call(g,e.inputtype,S.extend({},i,i.attr||{}),"",!0,f.p.ajaxSelectOptions||{},!0)),l=(S(p).addClass(q("searchDialog.elem","input-elm")),d=i.sopt||f.p.sopt||(-1!==S.inArray(e.searchtype,f.p.strarr)?f.p.stropts:f.p.numopts),""),u=0;for(y=[],S.each(f.p.ops,function(){y.push(this.oper)}),f.p.cops&&S.each(f.p.cops,function(e){y.push(e)}),r=0;r<d.length;r++)n=d[r],-1!==(h=S.inArray(d[r],y))&&(o=(void 0!==(o=f.p.ops[h])?o:f.p.cops[n]).text,0===u&&(c.op=n),l+="<option value='"+n+"'>"+o+"</option>",u++);S(".selectopts",t).empty().append(l),S(".selectopts",t)[0].selectedIndex=0,C.msie&&C.msiever()<9&&(s=parseInt(S("select.selectopts",t)[0].offsetWidth,10)+1,S(".selectopts",t).width(s),S(".selectopts",t).css("width","auto")),S(".data",t).empty().append(p),e.createColumnIndex&&i.generateDatalist&&(s="dl_"+p.id,null!=(a=S(g).jqGrid("generateDatalistFromColumnIndex",e.name))&&0<a.length&&(S(p).attr("list",s),S(".data",t).append(a.attr("id",s)))),C.bindEv.call(g,p,i),S(".input-elm",t).on("change",i,function(e){var t=e.target,e=e.data.column;c.data=e&&"custom"===e.inputtype&&F(e.searchoptions.custom_value)?e.searchoptions.custom_value.call(g,S(this).find(".customelement").first(),"get"):t.value,S(t).is("input[type=checkbox]")&&!S(t).is(":checked")&&(c.data=S(t).data("offval")),f.onchange()}),setTimeout(function(){c.data=S(p).val(),f.onchange()},0)}}),0),l=0;l<f.p.columns.length;l++)n=void 0===f.p.columns[l].search||f.p.columns[l].search,o=!0===f.p.columns[l].hidden,(!0===f.p.columns[l].searchoptions.searchhidden&&n||n&&!o)&&(r="",c.field===f.p.columns[l].name&&(r=" selected='selected'",p=l),a+="<option value='"+f.p.columns[l].name+"'"+r+">"+f.p.columns[l].label+"</option>");m.append(a);var u,v,i=S("<td class='operators'></td>"),b=(s.append(i),t=R.columns[p],!D||"text"!==t.inputtype||t.searchoptions.size||(t.searchoptions.size=10),S.extend({},t.editoptions||{})),b=(delete b.readonly,delete b.disabled,S.extend({},b,t.searchoptions||{},j(t.cmName),{id:C.randId(),name:t.name,mode:"search"})),b=(b.column=t,C.createEl.call(g,t.inputtype,S.extend({},b,b.attr||{}),c.data,!0,f.p.ajaxSelectOptions||{},!0)),w=(("nu"===c.op||"nn"===c.op||0<=S.inArray(c.op,g.p.customUnaryOperations))&&(S(b).attr("readonly","true"),S(b).attr("disabled","true")),S("<select class='"+q("searchDialog.operator","selectopts")+"'></select>"));for(i.append(w),w.on("change",function(){c.op=S(w).val();var e=S(this).parents("tr:first"),e=S(".input-elm",e)[0];"nu"===c.op||"nn"===c.op||0<=S.inArray(c.op,g.p.customUnaryOperations)?(c.data="","SELECT"!==e.tagName.toUpperCase()&&(e.value=""),e.setAttribute("readonly","true"),e.setAttribute("disabled","true")):("SELECT"===e.tagName.toUpperCase()&&(c.data=e.value),e.removeAttribute("readonly"),e.removeAttribute("disabled")),f.onchange()}),d=t.searchoptions.sopt||f.p.sopt||(-1!==S.inArray(t.searchtype,f.p.strarr)?f.p.stropts:f.p.numopts),a="",S.each(f.p.ops,function(){y.push(this.oper)}),f.p.cops&&S.each(f.p.cops,function(e){y.push(e)}),l=0;l<d.length;l++)v=d[l],-1!==(h=S.inArray(d[l],y))&&(u=f.p.ops[h],a+="<option value='"+v+"'"+(r=c.op===v?" selected='selected'":"")+">"+(void 0!==u?u:f.p.cops[v]).text+"</option>");w.append(a);var x,O,i=S("<td class='data'></td>"),i=(s.append(i),i.append(b),t.createColumnIndex&&t.searchoptions.generateDatalist&&(x="dl_"+b.id,null!=(O=S(g).jqGrid("generateDatalistFromColumnIndex",t.name))&&0<O.length&&(S(b).attr("list",x),i.append(O.attr("id",x)))),C.bindEv.call(g,b,t.searchoptions),S(b).addClass(q("searchDialog.elem","input-elm")).on("change",function(){c.data="custom"===t.inputtype?t.searchoptions.custom_value.call(g,S(this).find(".customelement").first(),"get"):S(this).val(),S(this).is("input[type=checkbox]")&&!S(this).is(":checked")&&(c.data=S(this).data("offval")),S.isArray(c.data)&&(c.data=c.data.join(R.inFilterSeparator||",")),f.onchange()}),S("<td></td>"));return s.append(i),!0===R.ruleButtons&&(O=S("<input type='button' value='-' title='"+A("deleteRuleTitle")+"' class='"+q("searchDialog.deleteRuleButton","delete-rule ui-del")+"'/>"),i.append(O),O.on("click",function(){for(l=0;l<e.rules.length;l++)if(e.rules[l]===c){e.rules.splice(l,1);break}return f.reDraw(),f.onchange(),!1})),s},this.getStringForGroup=function(e){var t,r="(";if(void 0!==e.groups)for(t=0;t<e.groups.length;t++){1<r.length&&(r+=" "+e.groupOp+" ");try{r+=this.getStringForGroup(e.groups[t])}catch(e){n(e)}}if(void 0!==e.rules)try{for(t=0;t<e.rules.length;t++)1<r.length&&(r+=" "+e.groupOp+" "),r+=this.getStringForRule(e.rules[t])}catch(e){n(e)}return"()"===(r+=")")?"":r},this.getStringForRule=function(e){for(var t,r,n="",o="",s=e.data,a=0;a<R.ops.length;a++)if(R.ops[a].oper===e.op){n=R.operands.hasOwnProperty(e.op)?R.operands[e.op]:"",o=R.ops[a].oper;break}if(""===o&&null!=R.cops)for(r in R.cops)if(R.cops.hasOwnProperty(r)&&(o=r,n=R.cops[r].operand,F(R.cops[r].buildQueryValue)))return R.cops[r].buildQueryValue.call(R,{cmName:e.field,searchValue:s,operand:n});for(a=0;a<R.columns.length;a++)if(R.columns[a].name===e.field){t=R.columns[a];break}return null==t?"":("bw"!==o&&"bn"!==o||(s+="%"),"ew"!==o&&"en"!==o||(s="%"+s),"cn"!==o&&"nc"!==o||(s="%"+s+"%"),"in"!==o&&"ni"!==o||(s=" ("+s+")"),R.errorcheck&&i(e.data,t),-1!==S.inArray(t.searchtype,["int","integer","float","number","currency"])||"nn"===o||"nu"===o||0<=S.inArray(o,k().p.customUnaryOperations)?e.field+" "+n+" "+s:e.field+" "+n+' "'+s+'"')},this.resetFilter=function(){R.filter=S.extend(!0,{},R.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){S("th."+h,this).html(""),S("tr.error",this).hide()},this.showError=function(){S("th."+h,this).html(R.errmsg),S("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(R.filter)},this.toString=function(){var o=this;return function e(t){var r,n="(";if(void 0!==t.groups)for(r=0;r<t.groups.length;r++)1<n.length&&("OR"===t.groupOp?n+=" || ":n+=" && "),n+=e(t.groups[r]);if(void 0!==t.rules)for(r=0;r<t.rules.length;r++)1<n.length&&("OR"===t.groupOp?n+=" || ":n+=" && "),n+=function(e){if(o.p.errorcheck){for(var t,r=0;r<o.p.columns.length;r++)if(o.p.columns[r].name===e.field){t=o.p.columns[r];break}t&&i(e.data,t)}return e.op+"(item."+e.field+",'"+e.data+"')"}(t.rules[r]);return"()"==(n+=")")?"":n}(R.filter)},this.reDraw(),R.showQuery&&this.onchange(),this.filter=!0}}})},S.extend(S.fn.jqFilter,{toSQLString:function(){var e="";return this.each(function(){e=this.toUserFriendlyString()}),e},filterData:function(){var e;return this.each(function(){e=this.p.filter}),e},getParameter:function(e){return void 0!==e&&this.p.hasOwnProperty(e)?this.p[e]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(e){"string"==typeof e&&(e=S.parseJSON(e)),this.each(function(){this.p.filter=e,this.reDraw(),this.onchange()})}})});
//# sourceMappingURL=grid.filter.js.map